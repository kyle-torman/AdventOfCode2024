using Main.SupportingComponents;

namespace Main.Day16
{
    internal class Challenge : BaseChallenge
    {
        public override Day Day => Day.Sixteen;

        public override Task<Solution> SolvePart1Async(InputType inputType)
        {
            var input = Input.GetInput(inputType);

            var contraption = MultidimensionalArrayParser.Parse2DArray(input, c => Tile.Create(c));
            var engergizedOutput = contraption.GetEnergizedOutputFromStartingPosition(new BeamPosition(0, 0, Direction.Right));
            return Task.FromResult(new Solution($"Number of Engergized Tiles: {engergizedOutput}"));
        }


        public override Task<Solution> SolvePart2Async(InputType inputType)
        {
            var input = Input.GetInput(inputType);

            var grid = MultidimensionalArrayParser.Parse2DArray(input);
            var startingPositions = new List<BeamPosition>();
            var lastColumn = grid.NumberOfColumns() - 1;
            var lastRow = grid.NumberOfRows() - 1;
            for (int i = 0; i < grid.NumberOfRows(); i++)
            {
                startingPositions.Add(new BeamPosition(0, i, Direction.Right));
                startingPositions.Add(new BeamPosition(lastColumn, i, Direction.Left));
            }
            for (int i = 0; i < grid.NumberOfColumns(); i++)
            {
                startingPositions.Add(new BeamPosition(i, 0, Direction.Down));
                startingPositions.Add(new BeamPosition(i, lastRow, Direction.Up));
            }

            var beamConfigurationOutputs = new Dictionary<string, int>();
            foreach (var startingPosition in startingPositions)
            {
                var contraption = MultidimensionalArrayParser.Parse2DArray(input, c => Tile.Create(c));
                var energizedOutput = contraption.GetEnergizedOutputFromStartingPosition(startingPosition);
                beamConfigurationOutputs.Add(startingPosition.ToString(), energizedOutput);
            }

            var maxOutput = beamConfigurationOutputs.Values.Max();
            return Task.FromResult(new Solution($"Max Output: {maxOutput}"));
        }

        protected override ChallengeInput Input => new ChallengeInput
        {
            TestInput = @".|...\....
|.-.\.....
.....|-...
........|.
..........
.........\
..../.\\..
.-.-/..|..
.|....-|.\
..//.|....",

            PuzzleInput = @"\./....|.........................../......................-........-..../..........................-..........
\............-................\..../......................\./\.....|././......-...............................
....-.....................-............\.....-.........\.\..............|-..\........|../\.........../........
....|..\..............-......................../..|..........././........|.............--.....................
.../....\............|............-./....|..........|....................-................|................|..
.........-...|........./...........|.................|.....--.................|...............................
...............................|..\........|.....|............|..............|...........................-....
.../...||......|.......|......|..-.|...............|...........-........\..\\................/..\.............
.........\.....|............|....|..................\./...././...../.............-...................|....|/..
...-............-./..|........\.|.............|........|.-\..\........|................/...........\..........
.........................\......|.....-...............\...|....|........-..-\../.....................\........
\/....-.....\....-...../.............|.-..-..............................-./....|.............................
.............-...\........./.............\.......................-|...\../...........-................./......
\......................./...........\........./..-.........-..|.....-......--.....\.....\-....................
.........\...........\................\................|\......./....-.......\..................-.............
|.......|.-.............-.......-/.....-...../...................--........................../.../....../..|..
.................-............|/..............-.\..................|.|....|\...../............\........\....\.
.....-.....|...............\............../......|...........................|...............|..../...........
\....-......|.....-.....................|...........\..\......-....................|....\.........\...........
..-..././...........................\\|..\-.\................../...|....../...|......................\........
...................../........-.......................\..\................/...............\....\...-./.-......
.............................|...................././......\.\........../......................\-............-
.....................................\...../.......|/.....|......|........//........./......./..|.|..-....\...
\.....................................................-./.............-.-..-.........-...\..........\...\.....
....../-.................||......................-.............-.-....|..............................-......-.
|........\.|.......-...............-..............-.\..\......|..\...|......../...|...........................
........|.............-..\......./........./.|...../...|........./....................|.....................|.
........|.....-...............-................|.....-.....-.......-....-\.....\../.................../....../
..|.........\...................................\..............-...|../.....\..................../............
.............|...............\................-......................-................/...........|.\.........
..-...........\...........\........../...........\..../...-.\\...|...../.../....-..............|.........\....
.././...\/.........................../.....\...................\\|\...|/......-|.|.......|.....-.|............
.....-.-...............|..\..........-........-................/...............|........\\./...............\..
.........|..|..............................|.../.............................|.............\..................
../...........././...|..........................\..-.-..-..\......-.........../.....|........../..............
....\............|......-.........\.|\.../..|........-..........-.............................................
.......-/.............-...............\.......-.....\......................\.|..././......../.................
....|.|.../../.....................-................/........................|.|-\......................../...
...|./.........-../......................................-..........-........../..\.............|../....\.....
..|.............\.........................................-|\-.|...................-........./................
................................-.......-......|........./........................-............\.../..........
....-..-...............|....................-......-.......-...........-|............|.........../.....|.\....
............................./..............................................\.....-.........-.....\...........
../.........\..................\..........-..-.\........................................................-...\.
......\....-.|..\..........|................/...........................--......../.......-.................-.
......-.............-........./.|./\|-............|.-........./........|...|../.-/../.....\.........\...|.....
........-\..-........\..\..../.......|..|./-./................../..|../..........\...........\.....././././...
|..........\............./...../.............|..||..\..../.................|................../...|....\/.....
................\............\.../..........\........\......\......|../.|..............\......-...............
........................./.-../....\.................\......./........|......../.....\...........\..|.........
...-....|.......|....-.........-......./...-........................................-.........................
...../.-...../-.\.............................\..|......../......./-..-...........|..|........................
............\........|.......\......\.\/..\./......................|...|......-....\................../.......
...............|...\.....-............-/..\......../........-.....|...........-............|....-..........|..
...........-...............\................/........./....................../..--........\......|\.|.........
....|.|...............|..........\..\.................|\./...\......|............/\...........................
.....|..-/............./......../............-.../../..\..............|.............../..........\..........\.
.......|...........\.|.....-.-..|.............-...................../.....-.\..\.........-/......\......|../..
..../...\...../........./................|.\............/..-....-./.-...../...|-.....-....-..-................
................/..-..................................-...-...........-...-\..................................
...............\.....\...............\\.|...|.....-........./|...\...............\......-.....................
.-......|..-...-.....|...............-..-...\../.....\\.................................\......\.....-.../....
............\..........|....|..|\.............\/...\.........-......\...\..-...\.................-..|..|.\/...
...|....\..................|..././......|....\............|\...........................................-......
.......-.................-.........|...........-............/......\.\....................\.......\\.....\....
...........|....|.....\/.....................|............|.|............\.....-...........|.\....|...........
....-........|................................................./-.|\...|......|........\./.............../....
...\...............-/........\...\..|......./..-......\.......|...\..../..................................../-
..\.........-....|.........../...-...|........|...............|...............|........../.......\\..\\\.....|
...-...\.............................|.............../|...........-\..........\.....|....\...|..-.............
.....-..............|......./.-...|.........................\........\................/...\.......|..........-
.............\.........|/..................../.../............/........|.....-............../...\.............
................|./.|...-.....................|.....|........................\...../.|...-\.........-../..../.
....................\..../.../...............-......-...................\............................|........
................./................/.....................................|................|............||.-....
.....|.............../.\..........-.........................................../....|..........................
.....-...........................................|......................\...................-.................
.......\|.|............./......\....../.............../...|....|.......-................\...\...-.........-...
....../..................-...../........--....................../............./............../................
/................-....../...|.-......-...............|........................................................
............................-.........................................../................./...............\...
.||........-.\/.\................................\|......\................|.....\....\..-......../.......-....
....|.........|..\..........-................/.........................|..|.........../.....\.../......\...../
..|......|.............\................\...\.................\..................-.........\.........|....\...
..../.-..-............\........-........././..\...|......................|...-.\..........-..........|.......\
\......../..-...........\..............................|...............-......../...........\..|....../.......
....--......|......../.\..........\.........-......\.................../\...\......../.............\..........
......|.....\|........................|....................\............/............/......\.........|..-....
..................\.............|..........-.....|......../........./.|..\..................................-.
.............../...........................................|....-../.......\....\.......|....\..\...|...-..\..
.-......\..................................|........\./............-.../..................-................../
..........\.................|./.\...-...........\...............-....-\/.\..|.......\.........................
\......\.|.........-..........-.../..................|............./......\..................-.......|........
.\......-...\.|..|.....-...........|......-....\...............|....|....|...../.........../-........./.......
..........|.......\......./.......|......\..............|.\\....-...............................\...../.......
/......-............-.../..............\.....-.......\....................\.................\.\..|............
...........|..................../.|............|............/................/...........-....................
.............................|...\....-...../../...........|......|............\\...|.../....|..../...........
........|............/........................../.......|.....|...........|...................../.\...........
...........\....................../.-.....\..............-........................................\......-...|
..-.......|..............-......................../..|............./........\.../.\\./..........-../..........
\.....................-............/....\.-...........\.............\............-...-......../\..............
.|......-.................................-..../.|......./.\............|........../...|./.......-............
...-\...........-............................\........|..|.........-...|...|.........................|..\/|...
\..............\.......-.......................\...-.........\....../.................|......-.\..............
............................|..|......../...\....-..........-|..../.........................|...............\.
............/..............................|...../....-.-..\..............|......|.\............/\......../|..
............|............../................................|.|......./...\........\...........|.|......../...
.............\...................................\-............................./..--.........-...........\.|.
....-....../......./.../.-.............-|......-.......|.-....../........\..........\.....-..................."
        };
    }
}
